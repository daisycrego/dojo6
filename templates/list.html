
{% set active_page = "listings" %}
{% extends 'base.html' %}

{% block content %}

{% if message is defined and message %}
    
    <span class="success">{{ message }}</span>

{% endif %}

<h3>{% block title %} {% if not show_inactive is defined or not show_inactive %} Active {% else %} Archived {%endif %} Listings {% endblock %}</h3>
<p> This page will have all of the Listings listed here, and for each listing it will link to the detail page for that listing </p>

        <span class="alongside">
            <a class="button" href="listing/create">Add a Listing</a>

            <form method="get" action="/scrape/all/">
                <button type="submit" onclick="return confirm('Are you sure you want to do that?');"> Collect All Listing Views </button>
            </form>
            
            <form method="post" action="/toggle_inactive">
            {% if show_inactive %} 
                <button name="show_inactive" type="submit" value={{False}}> View Active Listings </button>
            {% else %} 
                <button name="show_inactive" type="submit" value={{True}}> View Archived Listings </button>
                {% endif %}
            </form>
            
        </span>
        


        {% if listings %}
        <div class="table-container">

            <table>
                <tr>
                    <th>Listing Address</th>
                    <th>MLS</th>
                    <th>Agent</th>
                    <th>Listing Price</th>
                    <th>Status</th>
                    <th>Zillow Listing</th>
                    <th>Redfin Listing</th>
                    <th>Coldwell Banker Listing</th>
                    
                </tr>
    
                {% for listing in listings %}
                
                    {% if (not show_inactive and listing.status) or (show_inactive and not listing.status) %}

                    <tr>
                        <td><a href="/listing/{{listing.id}}">{{listing.address}}</a></td>
                        <td>{{listing.mls}}</td>
                        <td><a href="/agent/{{listing.agent.id}}">{{listing.agent.name}}</a></td>
                        <td>{{ "${:,}".format(listing.price) }}</td>
                        <td><p>{% if listing.status %} Active {% else %} Archived {% endif%}</p></td>
                        <td><a target="_blank" href={{listing.url_zillow}}>{{listing.url_zillow}}</a></td>
                        <td><a target="_blank" href={{listing.url_redfin}}>{{listing.url_redfin}}</a></td>
                        <td><a target="_blank" href={{listing.url_cb}}>{{listing.url_cb}}</a></td>
                    </tr>

                    {% endif %}
                
                {% endfor %}
            <table>

        </div>
        
        
        
            {% else %}
            <H2>No listings yet.</H2>

        {% endif %}
        

        


{% endblock %}